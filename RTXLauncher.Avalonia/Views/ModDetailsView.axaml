<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:RTXLauncher.Avalonia.ViewModels"
             xmlns:models="using:RTXLauncher.Core.Models"
             x:Class="RTXLauncher.Avalonia.Views.ModDetailsView"
             x:DataType="vm:ModDetailsViewModel">

	<Grid RowDefinitions="Auto,*" Margin="15">
		<!-- Details Panel -->
		<StackPanel Grid.Row="0" Spacing="10">

			<Button Content="‹ Back to Mod List"
                    Command="{Binding NavigateBackCommand}"
                    HorizontalAlignment="Left"/>

			<TextBlock Text="{Binding Summary}" TextWrapping="Wrap" FontSize="14" Margin="0,5,0,0"/>
			<StackPanel Orientation="Horizontal" Spacing="15">
				<TextBlock>
					<Run Text="Author:"/>
					<Run Text="{Binding Author}" FontWeight="Bold"/>
				</TextBlock>
				<TextBlock>
					<Run Text="Genre:"/>
					<Run Text="{Binding Genre}" FontWeight="Bold"/>
				</TextBlock>
				<TextBlock>
					<Run Text="Released:"/>
					<Run Text="{Binding ReleaseDate, StringFormat='d'}" FontWeight="Bold"/>
				</TextBlock>
			</StackPanel>
			<StackPanel Orientation="Horizontal" Spacing="15">
				<TextBlock>
					<Run Text="Popularity Rank:"/>
					<Run Text="{Binding Rank}" FontWeight="Bold"/>
				</TextBlock>
				<TextBlock>
					<Run Text="Total Visits:"/>
					<Run Text="{Binding TotalVisits, StringFormat='N0'}" FontWeight="Bold"/>
				</TextBlock>
			</StackPanel>
		</StackPanel>

		<!-- Files List and Progress -->
		<Grid Grid.Row="1" RowDefinitions="Auto,*,Auto" Margin="0,20,0,0">
			<TextBlock Grid.Row="0" Text="Available Files" FontSize="16" FontWeight="Bold"/>
			<ScrollViewer Grid.Row="1" Margin="0,10,0,0">
				<ItemsControl ItemsSource="{Binding Files}">
					<ItemsControl.ItemTemplate>
						<DataTemplate x:DataType="models:ModFile">
							<Border BorderBrush="Gray" BorderThickness="0,0,0,1" Padding="10">
								<Grid ColumnDefinitions="*,Auto">
									<StackPanel Grid.Column="0" VerticalAlignment="Center">
										<TextBlock Text="{Binding Title}" FontWeight="Bold"/>
										<TextBlock Text="{Binding PublishDate, StringFormat='Published on {0:D}'}" FontSize="11" Foreground="Gray"/>
									</StackPanel>

									<StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="10" VerticalAlignment="Center">
										<!-- Install Button -->
										<Button Content="Install"
                                                IsEnabled="{Binding !$parent[UserControl].DataContext.IsBusy}"
                                                Command="{Binding $parent[UserControl].DataContext.InstallFileCommand}"
                                                CommandParameter="{Binding}"
                                                IsVisible="{Binding !IsInstalled}"/>

										<!-- Installed Indicator & Uninstall Button -->
										<Panel IsVisible="{Binding IsInstalled}">
											<TextBlock Text="✔ Installed"
                                                       Foreground="LawnGreen"
                                                       FontWeight="Bold"
                                                       VerticalAlignment="Center"/>
											<Button Content="Uninstall"
                                                    Classes="destructive"
                                                    IsEnabled="{Binding !$parent[UserControl].DataContext.IsBusy}"
                                                    Command="{Binding $parent[UserControl].DataContext.UninstallFileCommand}"
                                                    CommandParameter="{Binding}"
                                                    Margin="90,0,0,0"/>
										</Panel>
									</StackPanel>
								</Grid>
							</Border>
						</DataTemplate>
					</ItemsControl.ItemTemplate>
				</ItemsControl>
			</ScrollViewer>

			<!-- Progress Bar for Downloads -->
			<ProgressBar Grid.Row="2"
                         Value="{Binding DownloadProgress}"
                         IsVisible="{Binding IsBusy}"
                         Height="10"
                         Margin="0,10,0,0"/>
		</Grid>
	</Grid>
</UserControl>