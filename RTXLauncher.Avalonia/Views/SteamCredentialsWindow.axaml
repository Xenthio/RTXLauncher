<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:RTXLauncher.Avalonia.ViewModels"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d" d:DesignWidth="500" d:DesignHeight="300"
        x:Class="RTXLauncher.Avalonia.Views.SteamCredentialsWindow"
        x:DataType="vm:SteamCredentialsViewModel"
        Title="Downgrade"
        Width="500" Height="300"
        MinWidth="500" MinHeight="300"
        MaxWidth="500" MaxHeight="300"
        WindowStartupLocation="CenterOwner"
        CanResize="False">

	<Design.DataContext>
		<vm:SteamCredentialsViewModel/>
	</Design.DataContext>

	<Grid RowDefinitions="Auto,*,Auto" Margin="20">

		<!-- Credentials Input -->
		<StackPanel Grid.Row="1" Spacing="15">
			
			<!-- Username -->
			<StackPanel Spacing="5" IsVisible="{Binding !ShowTwoFactorInput}">
				<TextBlock Text="Steam Username:" FontWeight="SemiBold"/>
				<TextBox Text="{Binding Username}" 
				         Watermark="Enter your Steam username"
				         Height="32"/>
			</StackPanel>

			<!-- Manifest ID -->
			<StackPanel Spacing="5" IsVisible="{Binding !ShowTwoFactorInput}">
				<TextBlock Text="Manifest ID:" FontWeight="SemiBold"/>
				<TextBox Text="{Binding ManifestId}" 
				         Watermark="Enter manifest ID"
				         Height="32"/>
				<StackPanel Spacing="3">
				<TextBlock TextWrapping="Wrap" FontSize="11" Foreground="#888888">
					The default is 1st May 2025 (last stable build). Find other manifests at:
				</TextBlock>
				<TextBlock Text="https://steamdb.info/depot/4002/manifests/" 
				           FontSize="11" 
				           Foreground="#0078D4"
				           Cursor="Hand"
				           TextDecorations="Underline"
				           PointerPressed="SteamDbLink_PointerPressed"/>
			</StackPanel>
			</StackPanel>

			<!-- Password (hidden in UsernameOnly mode) -->
			<StackPanel Spacing="5">
				<StackPanel.IsVisible>
					<MultiBinding Converter="{x:Static BoolConverters.And}">
						<Binding Path="!ShowTwoFactorInput"/>
						<Binding Path="!UsernameOnly"/>
					</MultiBinding>
				</StackPanel.IsVisible>
				<TextBlock Text="Steam Password:" FontWeight="SemiBold"/>
				<TextBox Text="{Binding Password}" 
				         Watermark="Enter your Steam password"
				         PasswordChar="â€¢"
				         Height="32"/>
			</StackPanel>

			<!-- 2FA Code (shown only when needed) -->
			<StackPanel Spacing="10" IsVisible="{Binding ShowTwoFactorInput}">
				<Border Background="#2033A1FD" 
				        BorderBrush="#33A1FD" 
				        BorderThickness="1" 
				        CornerRadius="5" 
				        Padding="10">
					<TextBlock TextWrapping="Wrap" FontSize="12">
						<Bold>Steam Guard Required</Bold>
						<LineBreak/>
						The download has started but requires 2FA authentication to continue.
					</TextBlock>
				</Border>
				
				<StackPanel Spacing="5">
					<TextBlock Text="Steam Guard 2FA Code:" FontWeight="SemiBold"/>
					<TextBox Text="{Binding TwoFactorCode}" 
					         Watermark="Enter your 2FA code"
					         Height="32"/>
				</StackPanel>
			</StackPanel>

			<!-- Info Text -->
			<Border Background="#2033A1FD" 
			        BorderBrush="#33A1FD" 
			        BorderThickness="1" 
			        CornerRadius="5" 
			        Padding="10"
			        IsVisible="{Binding !ShowTwoFactorInput}">
				<TextBlock TextWrapping="Wrap" FontSize="11">
					<Bold>Privacy:</Bold> Your credentials are used only to download the depot and are not stored.
				</TextBlock>
			</Border>
		</StackPanel>

		<!-- Action Buttons -->
		<Grid Grid.Row="2" ColumnDefinitions="*,Auto,Auto" ColumnSpacing="10" Margin="0,20,0,0">
			<Button Grid.Column="1" 
			        Content="Cancel" 
			        Width="100"
			        Click="CancelButton_Click"/>
			<Button Grid.Column="2" 
			        Content="Continue" 
			        Width="100"
			        Classes="accent"
			        Click="ContinueButton_Click"/>
		</Grid>
	</Grid>

	<Window.Styles>
		<Style Selector="Button.accent">
			<Setter Property="Background" Value="#0078D4"/>
			<Setter Property="Foreground" Value="White"/>
		</Style>
		
		<Style Selector="Button.accent:pointerover /template/ ContentPresenter">
			<Setter Property="Background" Value="#1084DE"/>
		</Style>
		
		<Style Selector="TextBlock:pointerover">
			<Setter Property="Opacity" Value="0.7"/>
		</Style>
	</Window.Styles>
</Window>
