<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:RTXLauncher.Avalonia.ViewModels"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d" d:DesignWidth="500" d:DesignHeight="520"
        x:Class="RTXLauncher.Avalonia.Views.SteamCredentialsWindow"
        x:DataType="vm:SteamCredentialsViewModel"
        Title="Downgrade"
        Width="500"
        MinWidth="500" MinHeight="280"
        MaxWidth="500" MaxHeight="600"
        SizeToContent="Height"
        WindowStartupLocation="CenterOwner"
        CanResize="False">

	<Design.DataContext>
		<vm:SteamCredentialsViewModel/>
	</Design.DataContext>

	<Grid RowDefinitions="Auto,*,Auto" Margin="25">

		<!-- Credentials Input -->
		<StackPanel Grid.Row="1" Spacing="20">
			
			<!-- Username / Password -->
			<StackPanel Spacing="18" IsVisible="{Binding !UseQrCode}">
				<!-- Username -->
				<StackPanel Spacing="6" IsVisible="{Binding !ShowTwoFactorInput}">
					<TextBlock Text="Steam Username:" FontWeight="SemiBold"/>
					<TextBox Text="{Binding Username}" 
					         Watermark="Enter your Steam username"
					         Height="36"/>
				</StackPanel>
				
				<!-- Password -->
				<StackPanel Spacing="6" IsVisible="{Binding !ShowTwoFactorInput}">
					<TextBlock Text="Steam Password:" FontWeight="SemiBold"/>
					<TextBox Text="{Binding Password}" 
					         Watermark="Enter your Steam password"
					         PasswordChar="â€¢"
					         Height="36"/>
				</StackPanel>

				<!-- Manifest ID -->
				<StackPanel Spacing="6" IsVisible="{Binding !ShowTwoFactorInput}">
					<TextBlock Text="Manifest ID:" FontWeight="SemiBold"/>
					<TextBox Text="{Binding ManifestId}" 
					         Watermark="Enter manifest ID"
					         Height="36"/>
					<StackPanel Spacing="4" Margin="0,4,0,0">
						<TextBlock TextWrapping="Wrap" FontSize="11" Foreground="#888888">
							The default is 1st May 2025 (last stable build). Find other manifests at:
						</TextBlock>
						<TextBlock Text="https://steamdb.info/depot/4002/manifests/" 
						           FontSize="11" 
						           Foreground="#0078D4"
						           Cursor="Hand"
						           TextDecorations="Underline"
						           PointerPressed="SteamDbLink_PointerPressed"/>
					</StackPanel>
				</StackPanel>
			</StackPanel>

			<!-- Auth options -->
			<StackPanel Spacing="8" IsVisible="{Binding !ShowTwoFactorInput}">
				<CheckBox Content="Use QR code login (Steam mobile app)" IsChecked="{Binding UseQrCode}"/>
				<CheckBox Content="Remember my login on this device" IsChecked="{Binding RememberPassword}"/>
				<CheckBox Content="Skip Steam mobile confirmation (if possible)" IsChecked="{Binding SkipAppConfirmation}"/>
			</StackPanel>

			<!-- 2FA Code (shown only when needed) -->
			<StackPanel Spacing="12" IsVisible="{Binding ShowTwoFactorInput}">
				<Border Background="#2033A1FD" 
				        BorderBrush="#33A1FD" 
				        BorderThickness="1" 
				        CornerRadius="5" 
				        Padding="12">
					<TextBlock TextWrapping="Wrap" FontSize="12">
						<Bold>Steam Guard Required</Bold>
						<LineBreak/>
						The download has started but requires 2FA authentication to continue.
					</TextBlock>
				</Border>
				
				<StackPanel Spacing="6">
					<TextBlock Text="Steam Guard 2FA Code:" FontWeight="SemiBold"/>
					<TextBox Text="{Binding TwoFactorCode}" 
					         Watermark="Enter your 2FA code"
					         Height="36"/>
				</StackPanel>
			</StackPanel>

			<!-- Info Text -->
			<Border Background="#2033A1FD" 
			        BorderBrush="#33A1FD" 
			        BorderThickness="1" 
			        CornerRadius="5" 
			        Padding="12"
			        IsVisible="{Binding !ShowTwoFactorInput}">
				<TextBlock TextWrapping="Wrap" FontSize="11">
					<Bold>Note:</Bold> Your credentials are used only to download the depot and are not stored unless you check the "Remember my login on this device" checkbox.
				</TextBlock>
			</Border>
		</StackPanel>

		<!-- Action Buttons -->
		<Grid Grid.Row="2" ColumnDefinitions="*,Auto,Auto" ColumnSpacing="10" Margin="0,20,0,0">
			<Button Grid.Column="1" 
			        Content="Cancel" 
			        Width="100"
			        Click="CancelButton_Click"/>
			<Button Grid.Column="2" 
			        Content="Continue" 
			        Width="100"
			        Classes="accent"
			        Click="ContinueButton_Click"/>
		</Grid>
	</Grid>

	<Window.Styles>
		<Style Selector="Button.accent">
			<Setter Property="Background" Value="#0078D4"/>
			<Setter Property="Foreground" Value="White"/>
		</Style>
		
		<Style Selector="Button.accent:pointerover /template/ ContentPresenter">
			<Setter Property="Background" Value="#1084DE"/>
		</Style>
		
		<Style Selector="TextBlock:pointerover">
			<Setter Property="Opacity" Value="0.7"/>
		</Style>
	</Window.Styles>
</Window>
