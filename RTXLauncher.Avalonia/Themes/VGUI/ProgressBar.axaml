<Styles xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:utils="using:RTXLauncher.Avalonia.Utilities">
	<StyleInclude Source="avares://RTXLauncher.Avalonia/Themes/VGUI/_Colors.axaml"/>
	<StyleInclude Source="avares://RTXLauncher.Avalonia/Themes/VGUI/_Globals.axaml"/>

	<Design.PreviewWith>
		<Border Padding="20" Background="{StaticResource VguiBackgroundBrush}">
			<StackPanel Spacing="5" Width="300">
				<TextBlock Text="Determinate (Value=65)" Foreground="White"/>
				<ProgressBar Value="65" />
				<TextBlock Text="Determinate (Value=26)" Foreground="White" Margin="0,5,0,0"/>
				<ProgressBar Value="26" />
				<TextBlock Text="Indeterminate (IsIndeterminate=True)" Foreground="White" Margin="0,5,0,0"/>
				<ProgressBar IsIndeterminate="True" />
			</StackPanel>
		</Border>
	</Design.PreviewWith>

	<Style Selector="ProgressBar">
		<Style.Resources>
			<DrawingBrush x:Key="ProgressBarIndicatorBrush" TileMode="Tile" SourceRect="0,0,12,16" DestinationRect="0,0,12,16">
				<DrawingBrush.Drawing>
					<GeometryDrawing Brush="{StaticResource VguiTextActiveColor}" Geometry="M0,0 H8 V16 H0 Z" />
				</DrawingBrush.Drawing>
			</DrawingBrush>
			<utils:ProgressBarWidthConverter x:Key="ProgressBarWidthConverter" />

			<utils:IndeterminateSnapConverter x:Key="IndeterminateSnapConverter" />

		</Style.Resources>

		<Setter Property="Background" Value="{StaticResource VguiInsetBackgroundColor}"/>
		<Setter Property="MinHeight" Value="24"/>
		<Setter Property="VerticalAlignment" Value="Center"/>

		<Setter Property="Template">
			<ControlTemplate>
				<Panel Name="PART_Root" Background="{TemplateBinding Background}">
					<Border BorderBrush="{StaticResource VguiBorderTopInsetBrush}" BorderThickness="1"/>
					<Border BorderBrush="{StaticResource VguiBorderBottomInsetBrush}" BorderThickness="0,0,1,1"/>

					<Panel Name="PART_Track" Margin="4" ClipToBounds="True">

						<Border Name="PART_Indicator" HorizontalAlignment="Left" Background="{StaticResource ProgressBarIndicatorBrush}" IsVisible="{TemplateBinding IsIndeterminate, Converter={x:Static BoolConverters.Not}}">
							<Border.Width>
								<MultiBinding Converter="{StaticResource ProgressBarWidthConverter}">
									<Binding Path="Value" RelativeSource="{RelativeSource TemplatedParent}"/>
									<Binding Path="Minimum" RelativeSource="{RelativeSource TemplatedParent}"/>
									<Binding Path="Maximum" RelativeSource="{RelativeSource TemplatedParent}"/>
									<Binding Path="Bounds.Width" RelativeSource="{RelativeSource AncestorType=Panel, AncestorLevel=1}"/>
								</MultiBinding>
							</Border.Width>
						</Border>

						<Border Name="IndeterminateIndicator" HorizontalAlignment="Left" Width="48" Background="{StaticResource ProgressBarIndicatorBrush}" IsVisible="{TemplateBinding IsIndeterminate}">
							<Border.RenderTransform>
								<TranslateTransform>
									<TranslateTransform.X>
										<!-- FIXED: Use the new IndeterminateSnapConverter -->
										<MultiBinding Converter="{StaticResource IndeterminateSnapConverter}">
											<Binding Path="(utils:AnimationProperties.IndeterminateValue)" RelativeSource="{RelativeSource TemplatedParent}"/>
											<Binding Path="Bounds.Width" ElementName="PART_Track"/>
											<Binding Path="Bounds.Width" RelativeSource="{RelativeSource AncestorType=Border}"/>
										</MultiBinding>
									</TranslateTransform.X>
								</TranslateTransform>
							</Border.RenderTransform>
						</Border>

					</Panel>
				</Panel>
			</ControlTemplate>
		</Setter>
	</Style>

	<!-- The Animation Style is completely unchanged -->
	<Style Selector="ProgressBar[IsIndeterminate=true]">
		<Style.Animations>
			<Animation Duration="0:0:2.5" IterationCount="Infinite" Easing="LinearEasing">
				<KeyFrame Cue="0%">
					<Setter Property="utils:AnimationProperties.IndeterminateValue" Value="0.0"/>
				</KeyFrame>
				<KeyFrame Cue="100%">
					<Setter Property="utils:AnimationProperties.IndeterminateValue" Value="1.0"/>
				</KeyFrame>
			</Animation>
		</Style.Animations>
	</Style>
</Styles>